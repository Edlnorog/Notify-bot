# Описание Telegram-бота «Поддержка рядом»

## Введение

Telegram-бот «Поддержка рядом» разработан для помощи людям с ограниченными возможностями здоровья (ОВЗ) в управлении приёмом лекарств. Бот позволяет добавлять лекарства, устанавливать расписание, получать напоминания, подтверждать или откладывать приём, генерировать отчёты и уведомлять доверенных лиц о пропуске приёма. Он интегрирован с веб-сайтом проекта «Помощь людям с ОВЗ: сайт для оказания экстренной помощи» и ориентирован на доступность, простоту и социальную значимость. Исходный код бота доступен в файле [bot.py](bot.py).

## Последовательность действий по исследованию предметной области и созданию технологии

### 1. Исследование предметной области

1. **Анализ потребностей целевой аудитории**:
   1. Проведено изучение проблем, с которыми сталкиваются люди с ОВЗ при приёме лекарств. Основные трудности включают забывчивость, сложности с самостоятельным управлением графиком приёма и потребность в поддержке родственников или волонтёров.
   2. Выявлены ключевые требования: простой интерфейс, оперативные уведомления и возможность отслеживания соблюдения режима.

2. **Обзор существующих решений**:
   1. Проанализированы приложения и боты для напоминаний о лекарствах, такие как Medisafe и MyTherapy. Их главный недостаток: сложные интерфейсы.
   2. Рассмотрены Telegram-боты для медицинских напоминаний. Telegram выбран как платформа благодаря:
      1) Популярности среди пользователей всех возрастов.
      2) Простоте интеграции через Bot API.
      3) Поддержке интерактивных элементов (кнопки, меню), совместимых с экранными читалками.

3. **Формирование функциональных требований**:
    Разработан перечень функций бота на основе анализа потребностей:
      1) Добавление лекарств с указанием названия, дозировки, формы, частоты, расписания и продолжительности курса.
      2) Отправка напоминаний о приёме с возможностью подтверждения или отсрочки на 10 минут.
      3) Генерация отчётов о соблюдении режима за неделю или месяц с экспортом в Excel.
      4) Уведомление доверенных лиц (например, родственников) при пропуске приёма через 30 минут после напоминания.
      5) Настройки уведомлений (включение/выключение) и управление списком доверенных лиц.
   

4. **Сбор обратной связи**:
   Проведены опросы среди 10 потенциальных пользователей, включая людей с ОВЗ, для уточнения предпочтений по интерфейсу и функционалу.

### 2. Создание технологии

1. **Выбор технологического стека**:
   1. **Язык программирования**: Выбран Python 3.8+ за его простоту, читаемость и обширную экосистему библиотек, подходящих для разработки ботов.
   2. **Библиотека для Telegram**: Использована `python-telegram-bot` (версия 13.x) для упрощения взаимодействия с Telegram Bot API, поддержки асинхронных операций и встроенной обработки диалогов.
   3. **Хранилище данных**: На этапе прототипирования применены словари Python для временного хранения данных о лекарствах, пользователях и доверенных лицах. Планируется переход на SQLite для реального внедрения.
   4. **Экспорт данных**: Использована библиотека `pandas` для генерации отчётов в формате Excel, обеспечивая удобный анализ данных о приёме лекарств.
   5. **Логирование**: Настроено с помощью модуля `logging` для отладки и мониторинга ошибок.

2. **Проектирование архитектуры**:
   1. Разработана модульная структура бота с использованием `ConversationHandler` для последовательного ввода данных (например, название лекарства → дозировка → форма → расписание).
   2. Реализована система напоминаний через `JobQueue`, позволяющая планировать ежедневные уведомления в заданное время.
   3. Спроектированы клавиатуры:
      1) `InlineKeyboardMarkup` для главного меню, подтверждений и навигации.
      2) `ReplyKeyboardMarkup` для выбора предустановленных вариантов (например, формы лекарства: «Таблетки», «Капсулы»).
   4. Разработана система обработки ошибок с логированием и пользовательскими сообщениями об ошибках.

3. **Разработка функционала**:
   1. Реализован процесс добавления лекарств через `ConversationHandler` с состояниями:
      1) `ADD_MED_NAME`: Ввод названия.
      2) `ADD_MED_DOSAGE`: Ввод дозировки.
      3) `ADD_MED_FORM`: Выбор формы (таблетки, капсулы и т.д.).
      4) `ADD_MED_FREQUENCY`: Выбор частоты (1, 2, 3 раза в день или по часам).
      5) `ADD_MED_SCHEDULE`: Указание времени приёма.
      6) `ADD_MED_DURATION`: Указание продолжительности курса.
   2. Настроены напоминания с помощью `JobQueue.run_daily`, отправляющие сообщения с кнопками «Я принял(а)» и «Отложить».
   3. Реализована функция подтверждения приёма (`confirm_intake`), сохраняющая историю в `medication['history']`.
   4. Добавлена функция отсрочки (`snooze_reminder`) на 10 минут с использованием `JobQueue.run_once`.
   5. Разработана генерация отчётов (`generate_report`) за 7 или 30 дней с расчётом процента соблюдения режима.
   6. Реализован экспорт данных в Excel через `pandas` (`export_to_excel`), создающий файл с историей приёма.
   7. Настроено добавление доверенных лиц через `ConversationHandler` и уведомления (`notify_relatives`) при пропуске приёма.
   8. Добавлены настройки уведомлений (`toggle_notifications`) для включения/выключения напоминаний.

4. **Интеграция с Telegram API**:
   1) Создан бот через @BotFather, получен токен для авторизации.
   2) Настроен `Updater` для обработки входящих сообщений и callback-запросов.
   3) Реализованы обработчики команд (`/start`), кнопок (`button_handler`) и диалогов.
   4) Использован механизм polling (`updater.start_polling`) для локального тестирования.

5. **Обеспечение доступности**:
   1) Интерфейс упрощён: минимальное количество шагов для добавления лекарства, чёткие текстовые подсказки.
   2) Использованы эмодзи (например, ⏰, ✅) для улучшения восприятия текста экранными читалками.
   3) Добавлены предустановленные варианты (например, «1 раз в день» → 9:00) для упрощения ввода.

6. **Тестирование**:
   1. Проведено модульное тестирование функций (добавление лекарств, напоминания, отчёты) в апреле 2025 года.
   2. Организовано тестирование с 10 пользователями, включая людей с ОВЗ, для оценки удобства интерфейса. Выявлены и исправлены проблемы:
      1) Некорректная обработка времени в разных часовых поясах.
      2) Отсутствие подтверждений при добавлении дублирующихся лекарств.

